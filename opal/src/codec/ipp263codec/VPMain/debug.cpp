#include <stdlib.h>
#include <stdio.h>
#include <windows.h>
#include "debug.h"

#define MAX_DBG_BUFF    1024

static void WriteLogFile(const char* pszLine);
static void NoLogFile(const char* pszLine)          { };
static void (*LogFile) (const char* pszLine) = WriteLogFile;


static void WriteLogFile(const char* pszLine)
{
    FILE* fOut = fopen(g_pszDebugLogFile,"a+");
    if (!fOut)
        LogFile = NoLogFile;
    else {
        fputs(pszLine, fOut); 
        fflush(fOut);
        fclose(fOut);
    }
}

static void OutpuLog(const char* pszLine)
{
#ifdef _UNICODE
    wchar_t buff[MAX_DBG_BUFF];
    swprintf(buff,L"%hs",pszLine);
    OutputDebugString(buff);
#else
    OutputDebugString(pszLine);
#endif
    LogFile(pszLine);
}

void dbLogFL(const char* pszFileName,int iLine,const char* pszFormat, ...)
{
    char  buff[MAX_DBG_BUFF];

    int iLen = _snprintf(buff,MAX_DBG_BUFF,"%s(%d) : ",pszFileName,iLine);

    va_list    args;
    va_start(args,pszFormat);

//    vsprintf(buff,pszFormat,args);
    iLen = _vsnprintf(buff+iLen,MAX_DBG_BUFF-iLen,pszFormat,args);
//  _vstprintf(buff,pszFrm,args);
    va_end(args);

    if (iLen > 0)
        OutpuLog(buff);
}

void dbLog(const char* pszFormat, ...)
{
    char  buff[MAX_DBG_BUFF];
    va_list    args;
    va_start(args,pszFormat);

//    vsprintf(buff,pszFormat,args);
    int iLen = _vsnprintf(buff,MAX_DBG_BUFF,pszFormat,args);

//  _vstprintf(buff,pszFrm,args);
    va_end(args);

    if (iLen > 0)
        OutpuLog(buff);
}

#if DBG_TRK
unsigned char Font_8x8[] = {
    0x01,0x00,0x08,0x00,0x08,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x81,
    0xa5,0x81,0xbd,0x99,0x81,0x7e,0x7e,0xff,
    0xdb,0xff,0xc3,0xe7,0xff,0x7e,0x36,0x7f,
    0x7f,0x7f,0x3e,0x1c,0x08,0x00,0x08,0x1c,
    0x3e,0x7f,0x3e,0x1c,0x08,0x00,0x1c,0x3e,
    0x1c,0x7f,0x7f,0x3e,0x1c,0x3e,0x08,0x08,
    0x1c,0x3e,0x7f,0x3e,0x1c,0x3e,0x00,0x00,
    0x18,0x3c,0x3c,0x18,0x00,0x00,0xff,0xff,
    0xe7,0xc3,0xc3,0xe7,0xff,0xff,0x00,0x3c,
    0x66,0x42,0x42,0x66,0x3c,0x00,0xff,0xc3,
    0x99,0xbd,0xbd,0x99,0xc3,0xff,0xf0,0xe0,
    0xf0,0xbe,0x33,0x33,0x33,0x1e,0x3c,0x66,
    0x66,0x66,0x3c,0x18,0x7e,0x18,0xfc,0xcc,
    0xfc,0x0c,0x0c,0x0e,0x0f,0x07,0xfe,0xc6,
    0xfe,0xc6,0xc6,0xe6,0x67,0x03,0x99,0x5a,
    0x3c,0xe7,0xe7,0x3c,0x5a,0x99,0x01,0x07,
    0x1f,0x7f,0x1f,0x07,0x01,0x00,0x40,0x70,
    0x7c,0x7f,0x7c,0x70,0x40,0x00,0x18,0x3c,
    0x7e,0x18,0x18,0x7e,0x3c,0x18,0x66,0x66,
    0x66,0x66,0x66,0x00,0x66,0x00,0xfe,0xdb,
    0xdb,0xde,0xd8,0xd8,0xd8,0x00,0x7c,0xc6,
    0x1c,0x36,0x36,0x1c,0x33,0x1e,0x00,0x00,
    0x00,0x00,0x7e,0x7e,0x7e,0x00,0x18,0x3c,
    0x7e,0x18,0x7e,0x3c,0x18,0xff,0x18,0x3c,
    0x7e,0x18,0x18,0x18,0x18,0x00,0x18,0x18,
    0x18,0x18,0x7e,0x3c,0x18,0x00,0x00,0x18,
    0x30,0x7f,0x30,0x18,0x00,0x00,0x00,0x0c,
    0x06,0x7f,0x06,0x0c,0x00,0x00,0x00,0x00,
    0x03,0x03,0x03,0x7f,0x00,0x00,0x00,0x24,
    0x66,0xff,0x66,0x24,0x00,0x00,0x00,0x18,
    0x3c,0x7e,0xff,0xff,0x00,0x00,0x00,0xff,
    0xff,0x7e,0x3c,0x18,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x1e,
    0x1e,0x0c,0x0c,0x00,0x0c,0x00,0x36,0x36,
    0x36,0x00,0x00,0x00,0x00,0x00,0x36,0x36,
    0x7f,0x36,0x7f,0x36,0x36,0x00,0x0c,0x3e,
    0x03,0x1e,0x30,0x1f,0x0c,0x00,0x00,0x63,
    0x33,0x18,0x0c,0x66,0x63,0x00,0x1c,0x36,
    0x1c,0x6e,0x3b,0x33,0x6e,0x00,0x06,0x06,
    0x03,0x00,0x00,0x00,0x00,0x00,0x18,0x0c,
    0x06,0x06,0x06,0x0c,0x18,0x00,0x06,0x0c,
    0x18,0x18,0x18,0x0c,0x06,0x00,0x00,0x66,
    0x3c,0xff,0x3c,0x66,0x00,0x00,0x00,0x0c,
    0x0c,0x3f,0x0c,0x0c,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x0c,0x0c,0x06,0x00,0x00,
    0x00,0x3f,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x0c,0x0c,0x00,0x60,0x30,
    0x18,0x0c,0x06,0x03,0x01,0x00,0x3e,0x63,
    0x73,0x7b,0x6f,0x67,0x3e,0x00,0x0c,0x0e,
    0x0c,0x0c,0x0c,0x0c,0x3f,0x00,0x1e,0x33,
    0x30,0x1c,0x06,0x33,0x3f,0x00,0x1e,0x33,
    0x30,0x1c,0x30,0x33,0x1e,0x00,0x38,0x3c,
    0x36,0x33,0x7f,0x30,0x78,0x00,0x3f,0x03,
    0x1f,0x30,0x30,0x33,0x1e,0x00,0x1c,0x06,
    0x03,0x1f,0x33,0x33,0x1e,0x00,0x3f,0x33,
    0x30,0x18,0x0c,0x0c,0x0c,0x00,0x1e,0x33,
    0x33,0x1e,0x33,0x33,0x1e,0x00,0x1e,0x33,
    0x33,0x3e,0x30,0x18,0x0e,0x00,0x00,0x0c,
    0x0c,0x00,0x00,0x0c,0x0c,0x00,0x00,0x0c,
    0x0c,0x00,0x00,0x0c,0x0c,0x06,0x18,0x0c,
    0x06,0x03,0x06,0x0c,0x18,0x00,0x00,0x00,
    0x3f,0x00,0x00,0x3f,0x00,0x00,0x06,0x0c,
    0x18,0x30,0x18,0x0c,0x06,0x00,0x1e,0x33,
    0x30,0x18,0x0c,0x00,0x0c,0x00,0x3e,0x63,
    0x7b,0x7b,0x7b,0x03,0x1e,0x00,0x0c,0x1e,
    0x33,0x33,0x3f,0x33,0x33,0x00,0x3f,0x66,
    0x66,0x3e,0x66,0x66,0x3f,0x00,0x3c,0x66,
    0x03,0x03,0x03,0x66,0x3c,0x00,0x1f,0x36,
    0x66,0x66,0x66,0x36,0x1f,0x00,0x7f,0x46,
    0x16,0x1e,0x16,0x46,0x7f,0x00,0x7f,0x46,
    0x16,0x1e,0x16,0x06,0x0f,0x00,0x3c,0x66,
    0x03,0x03,0x73,0x66,0x7c,0x00,0x33,0x33,
    0x33,0x3f,0x33,0x33,0x33,0x00,0x1e,0x0c,
    0x0c,0x0c,0x0c,0x0c,0x1e,0x00,0x78,0x30,
    0x30,0x30,0x33,0x33,0x1e,0x00,0x67,0x66,
    0x36,0x1e,0x36,0x66,0x67,0x00,0x0f,0x06,
    0x06,0x06,0x46,0x66,0x7f,0x00,0x63,0x77,
    0x7f,0x7f,0x6b,0x63,0x63,0x00,0x63,0x67,
    0x6f,0x7b,0x73,0x63,0x63,0x00,0x1c,0x36,
    0x63,0x63,0x63,0x36,0x1c,0x00,0x3f,0x66,
    0x66,0x3e,0x06,0x06,0x0f,0x00,0x1e,0x33,
    0x33,0x33,0x3b,0x1e,0x38,0x00,0x3f,0x66,
    0x66,0x3e,0x36,0x66,0x67,0x00,0x1e,0x33,
    0x07,0x0e,0x38,0x33,0x1e,0x00,0x3f,0x2d,
    0x0c,0x0c,0x0c,0x0c,0x1e,0x00,0x33,0x33,
    0x33,0x33,0x33,0x33,0x3f,0x00,0x33,0x33,
    0x33,0x33,0x33,0x1e,0x0c,0x00,0x63,0x63,
    0x63,0x6b,0x7f,0x77,0x63,0x00,0x63,0x63,
    0x36,0x1c,0x1c,0x36,0x63,0x00,0x33,0x33,
    0x33,0x1e,0x0c,0x0c,0x1e,0x00,0x7f,0x63,
    0x31,0x18,0x4c,0x66,0x7f,0x00,0x1e,0x06,
    0x06,0x06,0x06,0x06,0x1e,0x00,0x03,0x06,
    0x0c,0x18,0x30,0x60,0x40,0x00,0x1e,0x18,
    0x18,0x18,0x18,0x18,0x1e,0x00,0x08,0x1c,
    0x36,0x63,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0xff,0x0c,0x0c,
    0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x1e,0x30,0x3e,0x33,0x6e,0x00,0x07,0x06,
    0x06,0x3e,0x66,0x66,0x3b,0x00,0x00,0x00,
    0x1e,0x33,0x03,0x33,0x1e,0x00,0x38,0x30,
    0x30,0x3e,0x33,0x33,0x6e,0x00,0x00,0x00,
    0x1e,0x33,0x3f,0x03,0x1e,0x00,0x1c,0x36,
    0x06,0x0f,0x06,0x06,0x0f,0x00,0x00,0x00,
    0x6e,0x33,0x33,0x3e,0x30,0x1f,0x07,0x06,
    0x36,0x6e,0x66,0x66,0x67,0x00,0x0c,0x00,
    0x0e,0x0c,0x0c,0x0c,0x1e,0x00,0x30,0x00,
    0x30,0x30,0x30,0x33,0x33,0x1e,0x07,0x06,
    0x66,0x36,0x1e,0x36,0x67,0x00,0x0e,0x0c,
    0x0c,0x0c,0x0c,0x0c,0x1e,0x00,0x00,0x00,
    0x33,0x7f,0x7f,0x6b,0x63,0x00,0x00,0x00,
    0x1f,0x33,0x33,0x33,0x33,0x00,0x00,0x00,
    0x1e,0x33,0x33,0x33,0x1e,0x00,0x00,0x00,
    0x3b,0x66,0x66,0x3e,0x06,0x0f,0x00,0x00,
    0x6e,0x33,0x33,0x3e,0x30,0x78,0x00,0x00,
    0x3b,0x6e,0x66,0x06,0x0f,0x00,0x00,0x00,
    0x3e,0x03,0x1e,0x30,0x1f,0x00,0x08,0x0c,
    0x3e,0x0c,0x0c,0x2c,0x18,0x00,0x00,0x00,
    0x33,0x33,0x33,0x33,0x6e,0x00,0x00,0x00,
    0x33,0x33,0x33,0x1e,0x0c,0x00,0x00,0x00,
    0x63,0x6b,0x7f,0x7f,0x36,0x00,0x00,0x00,
    0x63,0x36,0x1c,0x36,0x63,0x00,0x00,0x00,
    0x33,0x33,0x33,0x3e,0x30,0x1f,0x00,0x00,
    0x3f,0x19,0x0c,0x26,0x3f,0x00,0x38,0x0c,
    0x0c,0x07,0x0c,0x0c,0x38,0x00,0x18,0x18,
    0x18,0x00,0x18,0x18,0x18,0x00,0x07,0x0c,
    0x0c,0x38,0x0c,0x0c,0x07,0x00,0x6e,0x3b,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,
    0x1c,0x36,0x63,0x63,0x7f,0x00,0x0c,0x1e,
    0x33,0x33,0x3f,0x33,0x33,0x00,0x7f,0x46,
    0x06,0x3e,0x66,0x66,0x3f,0x00,0x3f,0x66,
    0x66,0x3e,0x66,0x66,0x3f,0x00,0x7f,0x46,
    0x06,0x06,0x06,0x06,0x0f,0x00,0x3c,0x32,
    0x32,0x32,0x32,0x32,0x7f,0x41,0x7f,0x46,
    0x16,0x1e,0x16,0x46,0x7f,0x00,0x6b,0x6b,
    0x2a,0x1c,0x6b,0x6b,0x6b,0x00,0x1e,0x33,
    0x30,0x1c,0x30,0x33,0x1e,0x00,0x63,0x63,
    0x73,0x7b,0x6f,0x67,0x63,0x00,0x6b,0x63,
    0x73,0x7b,0x6f,0x67,0x63,0x00,0x67,0x66,
    0x36,0x1e,0x36,0x66,0x67,0x00,0x7c,0x66,
    0x66,0x66,0x66,0x66,0x67,0x00,0x63,0x77,
    0x7f,0x7f,0x6b,0x63,0x63,0x00,0x33,0x33,
    0x33,0x3f,0x33,0x33,0x33,0x00,0x1c,0x36,
    0x63,0x63,0x63,0x36,0x1c,0x00,0x3f,0x33,
    0x33,0x33,0x33,0x33,0x33,0x00,0x3f,0x66,
    0x66,0x3e,0x06,0x06,0x0f,0x00,0x3c,0x66,
    0x03,0x03,0x03,0x66,0x3c,0x00,0x3f,0x2d,
    0x0c,0x0c,0x0c,0x0c,0x1e,0x00,0x33,0x33,
    0x33,0x3e,0x30,0x33,0x1e,0x00,0x3e,0x6b,
    0x6b,0x6b,0x3e,0x08,0x1c,0x00,0x63,0x63,
    0x36,0x1c,0x1c,0x36,0x63,0x00,0x33,0x33,
    0x33,0x33,0x33,0x33,0x7f,0x40,0x33,0x33,
    0x33,0x33,0x3e,0x30,0x30,0x00,0x63,0x63,
    0x63,0x6b,0x6b,0x6b,0x7f,0x00,0x63,0x63,
    0x63,0x6b,0x6b,0x6b,0xff,0x80,0x1f,0x0d,
    0x0c,0x3c,0x6c,0x6c,0x3e,0x00,0x63,0x63,
    0x63,0x67,0x6b,0x6b,0x67,0x00,0x0f,0x06,
    0x06,0x3e,0x66,0x66,0x3f,0x00,0x1e,0x33,
    0x60,0x78,0x60,0x33,0x1e,0x00,0x33,0x6b,
    0x6b,0x6f,0x6b,0x6b,0x33,0x00,0x3e,0x33,
    0x33,0x3e,0x36,0x33,0x73,0x00,0x00,0x00,
    0x1e,0x30,0x3e,0x33,0x6e,0x00,0x38,0x0c,
    0x06,0x3e,0x66,0x66,0x3c,0x00,0x00,0x00,
    0x3f,0x66,0x3e,0x66,0x3f,0x00,0x00,0x00,
    0x7f,0x46,0x06,0x06,0x0f,0x00,0x00,0x00,
    0x3c,0x32,0x32,0x32,0x7f,0x41,0x00,0x00,
    0x1e,0x33,0x3f,0x03,0x1e,0x00,0x00,0x00,
    0x6b,0x6b,0x3e,0x6b,0x6b,0x00,0x00,0x00,
    0x3e,0x63,0x30,0x63,0x3e,0x00,0x00,0x00,
    0x63,0x73,0x6b,0x67,0x63,0x00,0x1c,0x00,
    0x63,0x73,0x6b,0x67,0x63,0x00,0x00,0x00,
    0x67,0x36,0x1e,0x36,0x67,0x00,0x00,0x00,
    0x7c,0x66,0x66,0x66,0x67,0x00,0x00,0x00,
    0x63,0x77,0x7f,0x6b,0x63,0x00,0x00,0x00,
    0x33,0x33,0x3f,0x33,0x33,0x00,0x00,0x00,
    0x1e,0x33,0x33,0x33,0x1e,0x00,0x00,0x00,
    0x3f,0x33,0x33,0x33,0x33,0x00,0x44,0x11,
    0x44,0x11,0x44,0x11,0x44,0x11,0xaa,0x55,
    0xaa,0x55,0xaa,0x55,0xaa,0x55,0xdb,0xee,
    0xdb,0x77,0xdb,0xee,0xdb,0x77,0x18,0x18,
    0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0x1f,0x18,0x18,0x18,0x18,0x18,
    0x1f,0x18,0x1f,0x18,0x18,0x18,0x6c,0x6c,
    0x6c,0x6c,0x6f,0x6c,0x6c,0x6c,0x00,0x00,
    0x00,0x00,0x7f,0x6c,0x6c,0x6c,0x00,0x00,
    0x1f,0x18,0x1f,0x18,0x18,0x18,0x6c,0x6c,
    0x6f,0x60,0x6f,0x6c,0x6c,0x6c,0x6c,0x6c,
    0x6c,0x6c,0x6c,0x6c,0x6c,0x6c,0x00,0x00,
    0x7f,0x60,0x6f,0x6c,0x6c,0x6c,0x6c,0x6c,
    0x6f,0x60,0x7f,0x00,0x00,0x00,0x6c,0x6c,
    0x6c,0x6c,0x7f,0x00,0x00,0x00,0x18,0x18,
    0x1f,0x18,0x1f,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x1f,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0xf8,0x00,0x00,0x00,0x18,0x18,
    0x18,0x18,0xff,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0xff,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0xf8,0x18,0x18,0x18,0x00,0x00,
    0x00,0x00,0xff,0x00,0x00,0x00,0x18,0x18,
    0x18,0x18,0xff,0x18,0x18,0x18,0x18,0x18,
    0xf8,0x18,0xf8,0x18,0x18,0x18,0x6c,0x6c,
    0x6c,0x6c,0xec,0x6c,0x6c,0x6c,0x6c,0x6c,
    0xec,0x0c,0xfc,0x00,0x00,0x00,0x00,0x00,
    0xfc,0x0c,0xec,0x6c,0x6c,0x6c,0x6c,0x6c,
    0xef,0x00,0xff,0x00,0x00,0x00,0x00,0x00,
    0xff,0x00,0xef,0x6c,0x6c,0x6c,0x6c,0x6c,
    0xec,0x0c,0xec,0x6c,0x6c,0x6c,0x00,0x00,
    0xff,0x00,0xff,0x00,0x00,0x00,0x6c,0x6c,
    0xef,0x00,0xef,0x6c,0x6c,0x6c,0x18,0x18,
    0xff,0x00,0xff,0x00,0x00,0x00,0x6c,0x6c,
    0x6c,0x6c,0xff,0x00,0x00,0x00,0x00,0x00,
    0xff,0x00,0xff,0x18,0x18,0x18,0x00,0x00,
    0x00,0x00,0xff,0x6c,0x6c,0x6c,0x6c,0x6c,
    0x6c,0x6c,0xfc,0x00,0x00,0x00,0x18,0x18,
    0xf8,0x18,0xf8,0x00,0x00,0x00,0x00,0x00,
    0xf8,0x18,0xf8,0x18,0x18,0x18,0x00,0x00,
    0x00,0x00,0xfc,0x6c,0x6c,0x6c,0x6c,0x6c,
    0x6c,0x6c,0xff,0x6c,0x6c,0x6c,0x18,0x18,
    0xff,0x18,0xff,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0x1f,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0xf8,0x18,0x18,0x18,0xff,0xff,
    0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,
    0x00,0x00,0xff,0xff,0xff,0xff,0x0f,0x0f,
    0x0f,0x0f,0x0f,0x0f,0x0f,0x0f,0xf0,0xf0,
    0xf0,0xf0,0xf0,0xf0,0xf0,0xf0,0xff,0xff,
    0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,
    0x3f,0x66,0x3e,0x06,0x0f,0x00,0x00,0x00,
    0x1e,0x33,0x03,0x33,0x1e,0x00,0x00,0x00,
    0x3f,0x2d,0x0c,0x0c,0x1e,0x00,0x00,0x00,
    0x33,0x33,0x3e,0x30,0x1f,0x00,0x00,0x00,
    0x3e,0x6b,0x6b,0x3e,0x08,0x00,0x00,0x00,
    0x63,0x36,0x1c,0x36,0x63,0x00,0x00,0x00,
    0x33,0x33,0x33,0x33,0x6e,0x40,0x00,0x00,
    0x33,0x33,0x3e,0x30,0x30,0x00,0x00,0x00,
    0x63,0x63,0x6b,0x6b,0x7f,0x00,0x00,0x00,
    0x63,0x63,0x6b,0x6b,0xff,0x80,0x00,0x00,
    0x0f,0x0d,0x3c,0x4c,0x3f,0x00,0x00,0x00,
    0x63,0x67,0x6b,0x6b,0x67,0x00,0x00,0x00,
    0x07,0x06,0x3e,0x46,0x3f,0x00,0x00,0x00,
    0x3f,0x60,0x78,0x60,0x3f,0x00,0x00,0x00,
    0x33,0x6b,0x6f,0x6b,0x33,0x00,0x00,0x00,
    0x6e,0x33,0x3e,0x34,0x73,0x00,0x00,0x3e,
    0x00,0x3e,0x00,0x3e,0x00,0x00,0x0c,0x0c,
    0x3f,0x0c,0x0c,0x00,0x3f,0x00,0x06,0x0c,
    0x18,0x0c,0x06,0x00,0x3f,0x00,0x18,0x0c,
    0x06,0x0c,0x18,0x00,0x3f,0x00,0x70,0xd8,
    0xd8,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0x18,0x1b,0x1b,0x0e,0x0c,0x0c,
    0x00,0x3f,0x00,0x0c,0x0c,0x00,0x00,0x6e,
    0x3b,0x00,0x6e,0x3b,0x00,0x00,0x1c,0x36,
    0x36,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x18,0x00,0x00,0x00,0xf0,0x30,
    0x30,0x30,0x37,0x36,0x3c,0x38,0x1e,0x36,
    0x36,0x36,0x36,0x00,0x00,0x00,0x0e,0x18,
    0x0c,0x06,0x1e,0x00,0x00,0x00,0x00,0x00,
    0x3c,0x3c,0x3c,0x3c,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0xfd,0xfd,
    0xfd,0xfd,0x00,0x00,0x00,0x00,0x00,0x00,
    0x25,0xae,0x0f,0xa0,0x0c,0x00};

#include "..\g2d\xBaseDisplay.h"


//unsigned char Font_8x8[];

void dbTextScr(int x, int y, const char* _pStr, int iLen)
{
    static bool b=true;
    const uchar* pStr = (const uchar*) _pStr;
	ushort cBackground = 0x0000;
	ushort cFont = 0xFFFF;
    int xPitch = ScreenLagotekPanel.xPitch;
    int yPitch = ScreenLagotekPanel.yPitch;
	uchar* pScr = ScreenLagotekPanel.pScreen + x*xPitch + y*yPitch;


    if (b) {
        dbLog("%d %d %s %d\n",x,y,_pStr,iLen);
        dbLog("pScr=0x%8.8x xPitch=%d yPitch=%d\n",pScr,xPitch,yPitch);
    }

	for (int c=0;c<iLen;++c,++pStr) {
		uchar* pLine = pScr; pScr += xPitch*8;
		uchar* pFnt = Font_8x8 + (*pStr)*8;
        for (int j = 0; j < 8; ++j, ++pFnt) {
            uchar* p = pLine; pLine += yPitch; 
            for (int i=1; i < 0x100; i <<= 1, p += xPitch) {
                if (*pFnt & i)
                    *((ushort*) p) = cFont;
                else
                    *((ushort*) p) = cBackground;
                if (b) {
                    dbLog("%c",*pFnt&i ? '*' : ' ');
                }
            }
            if (b)
                dbLog("\n");
        }
	}
    b=false;
}

void dbTrkScr(int iCode, int iLine)
{
	char buff[100];
	int iLen = sprintf(buff,"%-3d", iLine);
    dbLog("%d %d\n",iCode,iLine);
	if (iLen < 0)
		return;

	dbTextScr(3,(iCode&7)*10+20,buff,iLen);
}
#endif